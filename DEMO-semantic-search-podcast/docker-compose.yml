version: '3.4'

services:
  weaviate:
    image: semitechnologies/weaviate:1.22.6
    command:
      - --host
      - 0.0.0.0
      - --port
      - '8080'
      - --scheme
      - http
      - --read-timeout
      - '10000s'
      - --write-timeout
      - '10000s'
    ports:
      - "8083:8080"
      - "50053:50051"
    restart: no
    environment:
      - QUERY_DEFAULTS_LIMIT=25
      - QUERY_MAXIMUM_RESULTS=10000
      - AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED=true
      - PERSISTENCE_DATA_PATH=./data
      - DEFAULT_VECTORIZER_MODULE=text2vec-transformers
      - ENABLE_MODULES=text2vec-transformers
      - CLUSTER_HOSTNAME=node1
      - AUTOSCHEMA_ENABLED=false
      - TRANSFORMERS_INFERENCE_API=http://t2v-transformers:8080
    depends_on:
      - t2v-transformers

  t2v-transformers:
    image: semitechnologies/transformers-inference:sentence-transformers-multi-qa-distilbert-cos-v1
    environment:
      - ENABLE_CUDA=0
